/*! ng-crud 2015-08-04 Universidad de Los Andes */
!function(a){var b=a.module("CrudModule",["restangular","ui.bootstrap"]);b.constant("CrudTemplatesDir","src/crud/templates/"),b.config(["RestangularProvider",function(a){a.setBaseUrl("webresources"),a.addRequestInterceptor(function(a,b){return"remove"===b?null:a}),a.addResponseInterceptor(function(a,b,c,d,e){return"getList"===b&&e.headers("X-Total-Count")&&(a.totalRecords=parseInt(e.headers("X-Total-Count"))),a})}])}(window.angular),function(a,b){var c=a.module("CrudModule");c.service("actionsService",[function(){this.buildGlobalActions=function(a){return[{name:"create",displayName:"Create",icon:"plus",fn:function(){a.createRecord()},show:function(){return!a.readOnly&&!a.editMode}},{name:"refresh",displayName:"Refresh",icon:"refresh",fn:function(){a.fetchRecords()},show:function(){return!a.editMode}},{name:"save",displayName:"Save",icon:"save",fn:function(){a.saveRecord()},show:function(){return!a.readOnly&&a.editMode}},{name:"cancel",displayName:"Cancel",icon:"remove",fn:function(){a.fetchRecords()},show:function(){return!a.readOnly&&a.editMode}}]},this.buildRecordActions=function(a){return[{name:"edit",displayName:"Edit",icon:"edit",fn:function(b){a.editRecord(b)},show:function(){return!a.readOnly}},{name:"delete",displayName:"Delete",icon:"minus",fn:function(b){a.deleteRecord(b)},show:function(){return!a.readOnly}}]}}]),c.service("CRUDBase",["Restangular","actionsService","$injector",function(a,b,c){function d(a,d,e,f){function g(b,c){var d=["info","danger","warning","success"];d.some(function(a){return c===a})&&a.alerts.push({type:c,msg:b})}a.name=e,a.displayName=f,a.model=d,a.currentRecord={},a.records=[],a.alerts=[],this.maxSize=5,this.itemsPerPage=10,this.totalItems=0,this.currentPage=1,this.numPages=0,this.pageChanged=function(){this.fetchRecords()},this.readOnly=!1,this.editMode=!1,this.showError=function(a){g(a,"danger")},this.showSuccess=function(a){g(a,"success")},this.showWarning=function(a){g(a,"warning")},this.showInfo=function(a){g(a,"info")},this.closeAlert=function(b){a.alerts.splice(b,1)},this.loadRefOptions=function(){function b(a){var b=c.get(a.service);b.fetchRecords().then(function(b){a.options=b.plain(),a.required||a.options.unshift(null)})}var d=a.model;for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];"Reference"===f.type&&f.service&&c.has(f.service)&&b(f)}},this.globalActions=b.buildGlobalActions(this),this.recordActions=b.buildRecordActions(this)}function e(a,b,c,e,f){function g(a){h.showError(a.data)}d.call(this,a,b,e,f);var h=this;this.createRecord=function(){this.editMode=!0,a.currentRecord={}},this.editRecord=function(b){return c.fetchRecord(b).then(function(b){return a.currentRecord=b,h.editMode=!0,b},g)},this.fetchRecords=function(){return c.fetchRecords(this.currentPage,this.itemsPerPage).then(function(b){return a.records=b,h.totalItems=b.totalRecords,a.currentRecord={},h.editMode=!1,b},g)},this.saveRecord=function(){return c.saveRecord(a.currentRecord).then(function(){h.fetchRecords()},g)},this.deleteRecord=function(a){return c.deleteRecord(a).then(function(){h.fetchRecords()},g)}}function f(b){this.url=b,this.api=a.all(this.url),this.fetchRecords=function(a,b){return this.api.getList({page:a,maxRecords:b})},this.fetchRecord=function(a){return a.get()},this.saveRecord=function(a){return a.id?a.put():this.api.post(a)},this.deleteRecord=function(a){return a.remove()},this.extendController=function(a,b,c,d,f){e.call(a,b,c,this,d,f)}}this.extendCommonController=function(a,b,c,e,f){d.call(a,b,c,e,f)},this.extendService=function(a,b){f.call(a,b)}}]),c.service("masterUtils",["CRUDBase","actionsService","modalService",function(c,d,e){function f(a,b,d){c.extendCommonController(this,a,b,d,d);var e=this;a.$on("master-selected",function(b,c){void 0===c[d]&&(c[d]=[]),a.records=c[d],a.refId=c.id,e.fetchRecords&&e.fetchRecords()})}this.extendService=function(a,b){function d(){var a=this.extendController;this.extendController=function(b,c,d,e,f){a.call(this,b,c,d,e,f);var g=b.editRecord;b.editRecord=function(a){return g.call(this,a).then(function(a){return c.$broadcast("master-selected",a),a})};var h=b.createRecord;b.createRecord=function(){h.call(this),c.$broadcast("master-selected",c.currentRecord)},b.changeTab=function(a){c.tab=a}}}c.extendService(a,b),d.call(a)},this.extendCompChildCtrl=function(c,d,e,g,h){function i(c,d,e,g){function h(a){var b=void 0!==a.id?"id":"cid";for(var d in c.records)if(c.records.hasOwnProperty(d)){var e=c.records[d];if(e[b]===a[b])return d}}f.call(this,c,d,e),c.refName=g,this.fetchRecords=function(){c.currentRecord={},this.editMode=!1},this.saveRecord=function(){var a=c.currentRecord;if(a.id||a.cid){var d=h(a);c.records.splice(d,1,a)}else a.cid=-b.floor(1e4*b.random()),a[c.refName]={id:c.refId},c.records.push(a);this.fetchRecords()},this.deleteRecord=function(a){var b=h(a);c.records.splice(b,1)},this.editRecord=function(b){c.currentRecord=a.copy(b),this.editMode=!0},this.createRecord=function(){this.editMode=!0,c.currentRecord={}}}i.call(c,d,e,g,h)},this.extendAggChildCtrl=function(a,b,c,d,g){function h(a,b,c,d){f.call(this,a,b,c),this.showList=function(){var b=e.createSelectionModal(c,d.fetchRecords(),a.records);b.result.then(function(b){a.records.splice.call(a.records,0,a.records.length),a.records.push.apply(a.records,b)})};var g=this;this.globalActions=[{name:"select",displayName:"Select",icon:"check",fn:function(){g.showList()},show:function(){return!g.editMode}}],delete this.recordActions}h.call(a,b,c,d,g)}}]),c.service("modalService",["$modal","CrudTemplatesDir",function(a,b){this.createSelectionModal=function(c,d,e){return a.open({animation:!0,templateUrl:b+"modal.tpl.html",controller:"modalCtrl",resolve:{name:function(){return c},items:function(){return d},currentItems:function(){return e}}})}}])}(window.angular,window.Math),function(a){var b=a.module("CrudModule");b.directive("searchBar",["CrudTemplatesDir",function(a){return{scope:{name:"=",model:"=*",record:"=",submitFn:"&"},restrict:"E",templateUrl:a+"search.tpl.html"}}]),b.directive("listRecords",["CrudTemplatesDir",function(a){return{scope:{records:"=*",model:"=*",actions:"=*?",checklist:"=?"},restrict:"E",templateUrl:a+"list.tpl.html",controller:"listCtrl"}}]),b.directive("gallery",["CrudTemplatesDir",function(a){return{scope:{records:"=*",model:"=*",actions:"=*?",checklist:"=?"},restrict:"E",templateUrl:a+"gallery.tpl.html"}}]),b.directive("toolbar",["CrudTemplatesDir",function(a){return{scope:{actions:"=*",name:"=",displayName:"="},restrict:"E",templateUrl:a+"toolbar.tpl.html"}}]),b.directive("crudForm",["CrudTemplatesDir",function(a){return{scope:{name:"=",model:"=*",record:"="},restrict:"E",templateUrl:a+"form.tpl.html"}}]),b.directive("datePicker",["CrudTemplatesDir",function(a){return{scope:{model:"=",value:"="},restrict:"E",templateUrl:a+"datepicker.tpl.html",controller:"datePickerCtrl"}}])}(window.angular),function(a){var b=a.module("CrudModule");b.controller("listCtrl",["$scope",function(a){a.checkAll=function(){this.records.forEach(function(a){a.selected=!a.selected})}}]),b.controller("datePickerCtrl",["$scope",function(a){a.today=function(){a.value=new Date},a.clear=function(){a.value=null},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0}}]),b.controller("modalCtrl",["$scope","$modalInstance","items","name","currentItems",function(b,c,d,e,f){function g(b,c){a.forEach(c,function(c){a.forEach(b,function(a){a.id===c.id&&(a.selected=!0)})})}function h(){return b.items.filter(function(a){return!!a.selected})}b.model=[{name:"name",displayName:"Name",type:"String",order:1}],b.name=e,b.items=d,g(d,f),b.ok=function(){c.close(h())},b.cancel=function(){c.dismiss("cancel")}}])}(window.angular),angular.module("CrudModule").run(["$templateCache",function(a){"use strict";a.put("src/crud/templates/crud.tpl.html",'<toolbar name="name" display-name="displayName" actions="ctrl.globalActions"></toolbar>\r\n<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="ctrl.closeAlert($index)">{{alert.msg}}</alert>\r\n<div ng-hide="ctrl.editMode">\r\n    <list-records\r\n        model="model"\r\n        records="records"\r\n        actions="ctrl.recordActions">\r\n    </list-records>\r\n    <div class="text-center">\r\n        <pagination ng-show="ctrl.numPages > 1" num-pages="ctrl.numPages" total-items="ctrl.totalItems" ng-model="ctrl.currentPage" ng-change="ctrl.pageChanged()" items-per-page="ctrl.itemsPerPage" max-size="ctrl.maxSize" class="pagination-md" boundary-links="true" rotate="false"></pagination>\r\n    </div>\r\n</div>\r\n<div ng-show="ctrl.editMode" class="well">\r\n    <crud-form name="name" model="model" record="currentRecord"></crud-form>\r\n</div>\r\n'),a.put("src/crud/templates/datepicker.tpl.html",'<p class="input-group">\r\n    <input type="text" id="{{model.name}}" name="{{model.name}}" class="form-control" ng-model="value" ng-required="model.required" datepicker-popup is-open="opened" readonly />\r\n    <span class="input-group-btn">\r\n        <button type="button" id="{{model.name}}-datepicker" class="btn btn-default" ng-click="open($event)"><span class="glyphicon glyphicon-calendar"></span></button>\r\n    </span>\r\n</p>\r\n'),a.put("src/crud/templates/form.tpl.html",'<form novalidate name="form" id="{{name}}-form" role="form">\r\n    <fieldset>\r\n        <input id="id" class="form-control" type="hidden" ng-model="record.id"/>\r\n        <div class="form-group col-md-12" ng-repeat="column in model" ng-switch="column.type" ng-class="{\'has-success\': form[column.name].$valid && form[column.name].$dirty, \'has-error\': form[column.name].$invalid && form[column.name].$dirty}" >\r\n            <label for="{{column.name}}" class="col-md-2 control-label">{{column.displayName}}</label>\r\n            <div class="col-md-10">\r\n                <input ng-switch-when="String" id="{{column.name}}" name="{{column.name}}" class="form-control" type="text" ng-model="record[column.name]" ng-required="column.required" />\r\n                <input ng-switch-when="Integer" id="{{column.name}}" name="{{column.name}}" class="form-control" type="number" ng-model="record[column.name]" ng-required="column.required" />\r\n                <input ng-switch-when="Long" id="{{column.name}}" name="{{column.name}}" class="form-control" type="number" ng-model="record[column.name]" ng-required="column.required" />\r\n                <input ng-switch-when="Boolean" id="{{column.name}}" name="{{column.name}}" ng-checked="record[column.name]" type="checkbox" ng-model="record[column.name]" ng-required="column.required && record[column.name].$isEmpty" />\r\n                <input ng-switch-when="Computed" id="{{column.name}}" name="{{column.name}}" class="form-control" type="text" ng-value="column.fn(record)" readonly />\r\n                <input ng-switch-when="Image" id="{{column.name}}" name="{{column.name}}" class="form-control" type="url" ng-model="record[column.name]" ng-required="column.required"/>\r\n                <select ng-switch-when="Reference" id="{{column.name}}" name="{{column.name}}" class="form-control" ng-options="rc.name for rc in column.options track by rc.id" ng-model="record[column.name]"></select>\r\n                <date-picker ng-switch-when="Date" value="record[column.name]" model="column"></date-picker>\r\n            </div>\r\n        </div>\r\n    </fieldset>\r\n</form>\r\n'),a.put("src/crud/templates/gallery.tpl.html",'<div class="col-sm-12">\r\n    <div ng-repeat="record in records">\r\n        <div class="col-md-4 col-sm-6 col-lg-3 well">\r\n            <div class="col-md-12">\r\n                <div class="img-thumbnail" ng-class="{\'col-sm-4\': !$first}" ng-repeat="column in model| filter: {type: \'Image\'}" id="{{$parent.$index}}-{{column.name}}" ng-if="record[column.name]">\r\n                    <a ng-href="{{record[column.name]}}" target="_blank"><img class="img-responsive" ng-src="{{record[column.name]}}" alt="{{record[column.name]}}"></a>\r\n                </div>\r\n            </div>\r\n            <div class="caption" >\r\n                <div ng-repeat="column in model| filter: {type: \'!Image\'}" ng-switch="column.type" id="{{$parent.$index}}-{{column.name}}" ng-if="record[column.name] || column.fn">\r\n                    <p ng-switch-when="Computed"><strong>{{column.displayName}}:</strong> {{column.fn(record)}}</p>\r\n                    <p ng-switch-when="Date"><strong>{{column.displayName}}:</strong> {{record[column.name]| date}}</p>\r\n                    <p ng-switch-when="Reference"><strong>{{column.displayName}}:</strong> {{record[column.name].name}}</p>\r\n                    <p ng-switch-when="Boolean"><strong>{{column.displayName}}:</strong> <span ng-if="record[column.name] !== undefined" class="glyphicon" ng-class="{\'glyphicon-check\': record[column.name], \'glyphicon-unchecked\': !record[column.name]}"></span></p>\r\n                    <p ng-switch-when="String"><strong>{{column.displayName}}:</strong> {{record[column.name]}}</p>\r\n                    <p ng-switch-default><strong>{{column.displayName}}:</strong> {{record[column.name]}}</p>\r\n                </div>\r\n            </div>\r\n            <p ng-if="actions" class="text-center">\r\n                <button ng-repeat="action in actions" id="{{$parent.$index}}-{{action.name}}-btn" class="btn btn-default btn-sm" ng-show="action.show()" ng-click="action.fn(record)"><span class="glyphicon glyphicon-{{action.icon}}"></span> {{action.displayName}}</button>\r\n            </p>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),a.put("src/crud/templates/list.tpl.html",'<div>\r\n    <table class="table table-striped table-bordered">\r\n        <thead>\r\n            <tr>\r\n                <th ng-if="checklist" id="check-all"><input type="checkbox" ng-click="checkAll()"/></th>\r\n                <th ng-repeat="column in model">{{column.displayName}}</th>\r\n                <th ng-if="actions">Actions</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr ng-repeat="record in records">\r\n                <td ng-if="checklist" id="{{$index}}-selected"><input type="checkbox" ng-model="record.selected"/></td>\r\n                <td ng-repeat="column in model" ng-switch="column.type" id="{{$parent.$index}}-{{column.name}}">\r\n                    <div ng-switch-when="Computed">{{column.fn(record)}}</div>\r\n                    <div ng-switch-when="Date">{{record[column.name]| date}}</div>\r\n                    <div ng-switch-when="Reference">{{record[column.name].name}}</div>\r\n                    <div ng-switch-when="Boolean"><span ng-if="record[column.name] != undefined" class="glyphicon" ng-class="{\'glyphicon-check\': record[column.name], \'glyphicon-unchecked\': !record[column.name]}"></span></div>\r\n                    <div ng-switch-when="Image"><a ng-href="{{record[column.name]}}">URL</a></div>\r\n                    <div ng-switch-when="String">{{record[column.name]}}</div>\r\n                    <div ng-switch-default>{{record[column.name]}}</div>\r\n                </td>\r\n                <td ng-if="actions">\r\n                    <button ng-repeat="action in actions" id="{{$parent.$index}}-{{action.name}}-btn" class="btn btn-default btn-sm" ng-show="action.show()" ng-click="action.fn(record)"><span class="glyphicon glyphicon-{{action.icon}}"></span> {{action.displayName}}</button>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</div>\r\n'),a.put("src/crud/templates/modal.tpl.html",'<div class="modal-header">\r\n    <h3 class="modal-title">{{name}}</h3>\r\n</div>\r\n<div class="modal-body">\r\n    <list-records \r\n        model="model"\r\n        records="items"\r\n        checklist="true"></list-records>\r\n</div>\r\n<div class="modal-footer">\r\n    <button class="btn btn-default btn-sm" ng-click="ok()"><span class="glyphicon glyphicon-ok"></span> OK</button>\r\n    <button class="btn btn-default btn-sm" ng-click="cancel()"><span class="glyphicon glyphicon-remove"></span> Cancel</button>\r\n</div>\r\n'),a.put("src/crud/templates/search.tpl.html",'<form novalidate name="form" id="{{name}}-form" role="form" ng-submit="submitFn()" class="form-horizontal">\r\n    <legend>Search</legend>\r\n    <fieldset>\r\n        <div class="form-group col-md-12" ng-repeat="column in model|filter: {searchable: true}" ng-switch="column.type" ng-class="{\'has-success\': form[column.name].$valid && form[column.name].$dirty, \'has-error\': form[column.name].$invalid && form[column.name].$dirty}" >\r\n            <label for="{{column.name}}-search" class="col-md-2 control-label">{{column.displayName}}</label>\r\n            <div class="col-md-10">\r\n                <input ng-switch-when="String" id="{{column.name}}-search" name="{{column.name}}" class="form-control" type="text" ng-model="record[column.name]" ng-required="column.required"/>\r\n                <input ng-switch-when="Integer" id="{{column.name}}-search" name="{{column.name}}" class="form-control" type="number" ng-model="record[column.name]" ng-required="column.required"/>\r\n                <input ng-switch-when="Long" id="{{column.name}}-search" name="{{column.name}}" class="form-control" type="number" ng-model="record[column.name]" ng-required="column.required"/>\r\n                <input ng-switch-when="Boolean" id="{{column.name}}-search" name="{{column.name}}" type="checkbox" ng-model="record[column.name]" ng-checked="record[column.name]" ng-required="column.required && record[column.name].$isEmpty" />\r\n                <input ng-switch-when="Computed" id="{{column.name}}-search" name="{{column.name}}" class="form-control" type="text" ng-value="column.fn(record)" readonly/>\r\n                <select ng-switch-when="Reference" id="{{column.name}}-search" name="{{column.name}}" class="form-control" ng-options="rc.name for rc in column.options track by rc.id" ng-model="record[column.name]"></select>\r\n                <date-picker ng-switch-when="Date" value="record[column.name]" model="column"></date-picker>\r\n            </div>\r\n        </div>\r\n        <div class="form-group col-md-12">\r\n            <input type="submit" value="Search" class="form-control btn btn-primary" />\r\n        </div>\r\n    </fieldset>\r\n</form>\r\n'),a.put("src/crud/templates/toolbar.tpl.html",'<div id="{{name}}-header">\r\n    <nav class="navbar navbar-default" role="navigation">\r\n        <div class="container-fluid">\r\n            <!-- Brand and toggle get grouped for better mobile display -->\r\n            <div class="navbar-header">\r\n                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#{{name}}-navbar">\r\n                    <span class="sr-only">Toggle navigation</span>\r\n                    <span class="icon-bar"></span>\r\n                    <span class="icon-bar"></span>\r\n                    <span class="icon-bar"></span>\r\n                </button>\r\n                <a class="navbar-brand">{{displayName}}</a>\r\n            </div>\r\n\r\n            <!-- Collect the nav links, forms, and other content for toggling -->\r\n            <div class="collapse navbar-collapse" id="{{name}}-navbar">\r\n                <button ng-repeat="action in actions" id="{{action.name}}-{{name}}" class="btn btn-default navbar-btn" ng-show="action.show()" ng-click="action.fn()"><span class="glyphicon glyphicon-{{action.icon}}"></span> {{action.displayName}}</button>\r\n            </div>\r\n        </div>\r\n    </nav>\r\n</div>\r\n')}]);